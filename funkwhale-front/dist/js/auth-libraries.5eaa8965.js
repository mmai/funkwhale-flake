(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["auth-libraries"],{"0cd1":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("form",{staticClass:"ui form",on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[t.library?t._e():a("p",[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Libraries help you organize and share your music collections. You can upload your own music collection to Funkwhale and share it with your friends and family.")])],1),t.errors.length>0?a("div",{staticClass:"ui negative message",attrs:{role:"alert"}},[a("h4",{staticClass:"header"},[a("translate",{attrs:{"translate-context":"Content/*/Error message.Title"}},[t._v("Error")])],1),a("ul",{staticClass:"list"},t._l(t.errors,(function(e){return a("li",[t._v(t._s(e))])})),0)]):t._e(),a("div",{staticClass:"required field"},[a("label",{attrs:{for:"current-name"}},[a("translate",{attrs:{"translate-context":"*/*/*/Noun"}},[t._v("Name")])],1),a("input",{directives:[{name:"model",rawName:"v-model",value:t.currentName,expression:"currentName"}],attrs:{id:"current-name",name:"name",placeholder:t.labels.namePlaceholder,required:"",maxlength:"100"},domProps:{value:t.currentName},on:{input:function(e){e.target.composing||(t.currentName=e.target.value)}}})]),a("div",{staticClass:"field"},[a("label",{attrs:{for:"current-description"}},[a("translate",{attrs:{"translate-context":"*/*/*/Noun"}},[t._v("Description")])],1),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.currentDescription,expression:"currentDescription"}],attrs:{id:"current-description",placeholder:t.labels.descriptionPlaceholder,maxlength:"2000"},domProps:{value:t.currentDescription},on:{input:function(e){e.target.composing||(t.currentDescription=e.target.value)}}})]),a("div",{staticClass:"field"},[a("label",{attrs:{for:"visibility-level"}},[a("translate",{attrs:{"translate-context":"*/*/*"}},[t._v("Visibility")])],1),a("p",[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("You are able to share your library with other people, regardless of its visibility.")])],1),a("select",{directives:[{name:"model",rawName:"v-model",value:t.currentVisibilityLevel,expression:"currentVisibilityLevel"}],staticClass:"ui dropdown",attrs:{id:"visibility-level"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.currentVisibilityLevel=e.target.multiple?a:a[0]}}},t._l(["me","instance","everyone"],(function(e){return a("option",{domProps:{value:e}},[t._v(t._s(t.sharedLabels.fields.privacy_level.choices[e]))])})),0)]),a("button",{staticClass:"ui submit button",attrs:{type:"submit"}},[t.library?a("translate",{attrs:{"translate-context":"Content/Library/Button.Label/Verb"}},[t._v("Update library")]):a("translate",{attrs:{"translate-context":"Content/Library/Button.Label/Verb"}},[t._v("Create library")])],1),t.library?a("dangerous-button",{staticClass:"ui right floated basic danger button",on:{confirm:function(e){return t.remove()}}},[a("translate",{attrs:{"translate-context":"*/*/*/Verb"}},[t._v("Delete")]),a("p",{attrs:{slot:"modal-header"},slot:"modal-header"},[a("translate",{attrs:{"translate-context":"Popup/Library/Title"}},[t._v("Delete this library?")])],1),a("p",{attrs:{slot:"modal-content"},slot:"modal-content"},[a("translate",{attrs:{"translate-context":"Popup/Library/Paragraph"}},[t._v(" The library and all its tracks will be deleted. This can not be undone. ")])],1),a("div",{attrs:{slot:"modal-confirm"},slot:"modal-confirm"},[a("translate",{attrs:{"translate-context":"Popup/Library/Button.Label/Verb"}},[t._v("Delete library")])],1)],1):t._e()],1)},s=[],i=(a("a4d3"),a("e01a"),a("b0c0"),a("bc3a")),n=a.n(i),o=a("64c4"),l={mixins:[o["a"]],props:["library"],data:function(){var t={isLoading:!1,over:!1,errors:[]};return this.library?(t.currentVisibilityLevel=this.library.privacy_level,t.currentName=this.library.name,t.currentDescription=this.library.description):(t.currentVisibilityLevel="me",t.currentName="",t.currentDescription=""),t},computed:{labels:function(){var t=this.$pgettext("Content/Library/Input.Placeholder","My awesome library"),e=this.$pgettext("Content/Library/Input.Placeholder","This library contains my personal music, I hope you like it.");return{namePlaceholder:t,descriptionPlaceholder:e}}},methods:{submit:function(){var t=this,e=this;this.isLoading=!0;var a,r={name:this.currentName,description:this.currentDescription,privacy_level:this.currentVisibilityLevel};a=this.library?n.a.patch("libraries/".concat(this.library.uuid,"/"),r):n.a.post("libraries/",r),a.then((function(a){var r;e.isLoading=!1,e.library?(e.$emit("updated",a.data),r=t.$pgettext("Content/Library/Message","Library updated")):(e.$emit("created",a.data),r=t.$pgettext("Content/Library/Message","Library created")),e.$store.commit("ui/addMessage",{content:r,date:new Date})}),(function(t){e.isLoading=!1,e.errors=t.backendErrors}))},reset:function(){this.currentVisibilityLevel="me",this.currentName="",this.currentDescription=""},remove:function(){var t=this,e=this;n.a.delete("libraries/".concat(this.library.uuid,"/")).then((function(a){e.isLoading=!1;var r=t.$pgettext("Content/Library/Message","Library deleted");e.$emit("deleted",{}),e.$store.commit("ui/addMessage",{content:r,date:new Date})}),(function(t){e.isLoading=!1,e.errors=t.backendErrors}))}}},c=l,u=a("2877"),d=Object(u["a"])(c,r,s,!1,null,null,null);e["a"]=d.exports},"11b8":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"ui vertical aligned stripe segment"},[t.isLoading?a("div",{class:["ui",{active:t.isLoading},"inverted","dimmer"]},[a("div",{staticClass:"ui text loader"},[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Loading Libraries…")])],1)]):a("div",{staticClass:"ui text container"},[a("h1",{staticClass:"ui header"},[a("translate",{attrs:{"translate-context":"Content/Library/Title"}},[t._v("My libraries")])],1),0==t.libraries.length?a("p",[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Looks like you don't have a library, it's time to create one.")])],1):t._e(),a("a",{attrs:{"aria-expanded":!t.hiddenForm,href:""},on:{click:function(e){e.preventDefault(),t.hiddenForm=!t.hiddenForm}}},[t.hiddenForm?a("i",{staticClass:"plus icon"}):a("i",{staticClass:"minus icon"}),a("translate",{attrs:{"translate-context":"Content/Library/Link/Verb"}},[t._v("Create a new library")])],1),t.hiddenForm?t._e():a("library-form",{attrs:{library:null},on:{created:t.libraryCreated}}),a("div",{staticClass:"ui hidden divider"}),a("quota"),a("div",{staticClass:"ui hidden divider"}),t.libraries.length>0?a("div",{staticClass:"ui two column grid"},t._l(t.libraries,(function(t){return a("div",{key:t.uuid,staticClass:"column"},[a("library-card",{attrs:{library:t}})],1)})),0):t._e()],1)])},s=[],i=a("bc3a"),n=a.n(i),o=a("0cd1"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ui card"},[a("div",{staticClass:"content"},[a("h4",{staticClass:"header"},[t._v(" "+t._s(t.library.name)+" "),"me"===t.library.privacy_level?a("span",{staticClass:"right floated",attrs:{"data-tooltip":t.privacy_tooltips("me")}},[a("i",{staticClass:"small lock icon"})]):"instance"===t.library.privacy_level?a("span",{staticClass:"right floated",attrs:{"data-tooltip":t.privacy_tooltips("instance")}},[a("i",{staticClass:"small circle outline icon"})]):"everyone"===t.library.privacy_level?a("span",{staticClass:"right floated",attrs:{"data-tooltip":t.privacy_tooltips("everyone")}},[a("i",{staticClass:"small globe icon"})]):t._e()]),a("div",{staticClass:"meta"},[a("span",[a("i",{staticClass:"small outline clock icon"}),a("human-date",{attrs:{date:t.library.creation_date}})],1)]),a("div",{staticClass:"description"},[t._v(" "+t._s(t.library.description)+" "),a("div",{staticClass:"ui hidden divider"})]),a("div",{staticClass:"content"},[t.library.size?a("span",{staticClass:"right floated",attrs:{"data-tooltip":t.size_label}},[a("i",{staticClass:"database icon"}),t._v(" "+t._s(t._f("humanSize")(t.library.size))+" ")]):t._e(),a("i",{staticClass:"music icon"}),a("translate",{attrs:{"translate-context":"*/*/*","translate-params":{count:t.library.uploads_count},"translate-n":t.library.uploads_count,"translate-plural":"%{ count } tracks"}},[t._v("%{ count } track")])],1)]),a("div",{staticClass:"ui bottom basic attached buttons"},[a("router-link",{staticClass:"ui button",attrs:{to:{name:"library.detail.upload",params:{id:t.library.uuid}}}},[a("translate",{attrs:{"translate-context":"Content/Library/Card.Button.Label/Verb"}},[t._v("Upload")])],1),a("router-link",{staticClass:"ui button",attrs:{to:{name:"library.detail",params:{id:t.library.uuid}},exact:""}},[a("translate",{attrs:{"translate-context":"Content/Library/Card.Button.Label/Noun"}},[t._v("Library Details")])],1)],1)])},c=[],u=a("64c4"),d={mixins:[u["a"]],props:["library"],methods:{privacy_tooltips:function(t){return"Visibility: "+this.sharedLabels.fields.privacy_level.choices[t].toLowerCase()}},computed:{size_label:function(){return this.$pgettext("Content/Library/Card.Help text","Total size of the files in this library")}}},p=d,b=a("2877"),h=Object(b["a"])(p,l,c,!1,null,null,null),f=h.exports,v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ui segment"},[a("h3",{staticClass:"ui header"},[a("translate",{attrs:{"translate-context":"Content/Library/Title"}},[t._v("Current usage")])],1),t.isLoading?a("div",{class:["ui",{active:t.isLoading},"inverted","dimmer"]},[a("div",{staticClass:"ui text loader"},[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Loading usage data…")])],1)]):t._e(),a("div",{class:["ui",{success:t.progress<60},{warning:t.progress>=60&&t.progress<96},{error:t.progress>=95},"progress"],attrs:{"data-percent":"progress"}},[a("div",{staticClass:"bar",style:{width:t.progress+"%"}},[a("div",{staticClass:"progress"},[t._v(t._s(t.progress)+"%")])]),t.quotaStatus?a("div",{staticClass:"label"},[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph","translate-params":{max:t.humanSize(1e3*t.quotaStatus.max*1e3),current:t.humanSize(1e3*t.quotaStatus.current*1e3)}}},[t._v("%{ current } used on %{ max } allowed")])],1):t._e()]),a("div",{staticClass:"ui hidden divider"}),t.quotaStatus?a("div",{staticClass:"ui stackable three column grid"},[t.quotaStatus.pending>0?a("div",{staticClass:"column"},[a("div",{staticClass:"ui tiny warning statistic"},[a("div",{staticClass:"value"},[t._v(" "+t._s(t.humanSize(1e3*t.quotaStatus.pending*1e3))+" ")]),a("div",{staticClass:"label"},[a("translate",{attrs:{"translate-context":"Content/Library/Label"}},[t._v("Pending files")])],1)]),a("div",[a("router-link",{staticClass:"ui basic primary tiny button",attrs:{to:{name:"content.libraries.files",query:{q:t.compileTokens([{field:"status",value:"pending"}])}}}},[a("translate",{attrs:{"translate-context":"Content/Library/Link/Verb"}},[t._v("View files")])],1),a("dangerous-button",{staticClass:"ui basic tiny button",attrs:{action:t.purgePendingFiles}},[a("translate",{attrs:{"translate-context":"*/*/*/Verb"}},[t._v("Purge")]),a("p",{attrs:{slot:"modal-header"},slot:"modal-header"},[a("translate",{attrs:{"translate-context":"Popup/Library/Title"}},[t._v("Purge pending files?")])],1),a("p",{attrs:{slot:"modal-content"},slot:"modal-content"},[a("translate",{attrs:{"translate-context":"Popup/Library/Paragraph"}},[t._v("Removes uploaded but yet to be processed tracks completely, adding the corresponding data to your quota.")])],1),a("div",{attrs:{slot:"modal-confirm"},slot:"modal-confirm"},[a("translate",{attrs:{"translate-context":"*/*/*/Verb"}},[t._v("Purge")])],1)],1)],1)]):t._e(),t.quotaStatus.skipped>0?a("div",{staticClass:"column"},[a("div",{staticClass:"ui tiny statistic"},[a("div",{staticClass:"value"},[t._v(" "+t._s(t.humanSize(1e3*t.quotaStatus.skipped*1e3))+" ")]),a("div",{staticClass:"label"},[a("translate",{attrs:{"translate-context":"Content/Library/Label"}},[t._v("Skipped files")])],1)]),a("div",[a("router-link",{staticClass:"ui basic primary tiny button",attrs:{to:{name:"content.libraries.files",query:{q:t.compileTokens([{field:"status",value:"skipped"}])}}}},[a("translate",{attrs:{"translate-context":"Content/Library/Link/Verb"}},[t._v("View files")])],1),a("dangerous-button",{staticClass:"ui basic tiny button",attrs:{action:t.purgeSkippedFiles}},[a("translate",{attrs:{"translate-context":"*/*/*/Verb"}},[t._v("Purge")]),a("p",{attrs:{slot:"modal-header"},slot:"modal-header"},[a("translate",{attrs:{"translate-context":"Popup/Library/Title"}},[t._v("Purge skipped files?")])],1),a("p",{attrs:{slot:"modal-content"},slot:"modal-content"},[a("translate",{attrs:{"translate-context":"Popup/Library/Paragraph"}},[t._v("Removes uploaded tracks skipped during the import processes completely, adding the corresponding data to your quota.")])],1),a("div",{attrs:{slot:"modal-confirm"},slot:"modal-confirm"},[a("translate",{attrs:{"translate-context":"*/*/*/Verb"}},[t._v("Purge")])],1)],1)],1)]):t._e(),t.quotaStatus.errored>0?a("div",{staticClass:"column"},[a("div",{staticClass:"ui tiny danger statistic"},[a("div",{staticClass:"value"},[t._v(" "+t._s(t.humanSize(1e3*t.quotaStatus.errored*1e3))+" ")]),a("div",{staticClass:"label"},[a("translate",{attrs:{"translate-context":"Content/Library/Label"}},[t._v("Errored files")])],1)]),a("div",[a("router-link",{staticClass:"ui basic primary tiny button",attrs:{to:{name:"content.libraries.files",query:{q:t.compileTokens([{field:"status",value:"errored"}])}}}},[a("translate",{attrs:{"translate-context":"Content/Library/Link/Verb"}},[t._v("View files")])],1),a("dangerous-button",{staticClass:"ui basic tiny button",attrs:{action:t.purgeErroredFiles}},[a("translate",{attrs:{"translate-context":"*/*/*/Verb"}},[t._v("Purge")]),a("p",{attrs:{slot:"modal-header"},slot:"modal-header"},[a("translate",{attrs:{"translate-context":"Popup/Library/Title"}},[t._v("Purge errored files?")])],1),a("p",{attrs:{slot:"modal-content"},slot:"modal-content"},[a("translate",{attrs:{"translate-context":"Popup/Library/Paragraph"}},[t._v("Removes uploaded tracks that could not be processed by the server completely, adding the corresponding data to your quota.")])],1),a("div",{attrs:{slot:"modal-confirm"},slot:"modal-confirm"},[a("translate",{attrs:{"translate-context":"*/*/*/Verb"}},[t._v("Purge")])],1)],1)],1)]):t._e()]):t._e()])},m=[],g=(a("d3b7"),a("e25e"),a("98fc")),y=a("3255"),_={data:function(){return{quotaStatus:null,isLoading:!1,humanSize:g["a"],compileTokens:y["a"]}},created:function(){this.fetch()},methods:{fetch:function(){var t=this;t.isLoading=!0,n.a.get("users/me/").then((function(e){t.quotaStatus=e.data.quota_status,t.isLoading=!1}))},purge:function(t){var e=this,a={action:"delete",objects:"all",filters:{import_status:t}};n.a.post("uploads/action/",a).then((function(t){e.fetch()}))},purgeSkippedFiles:function(){this.purge("skipped")},purgePendingFiles:function(){this.purge("pending")},purgeErroredFiles:function(){this.purge("errored")}},computed:{progress:function(){return this.quotaStatus?Math.min(parseInt(100*this.quotaStatus.current/this.quotaStatus.max),100):0}}},C=_,L=Object(b["a"])(C,v,m,!1,null,null,null),x=L.exports,w={data:function(){return{isLoading:!1,hiddenForm:!0,libraries:[]}},created:function(){this.fetch()},components:{LibraryForm:o["a"],LibraryCard:f,Quota:x},methods:{fetch:function(){this.isLoading=!0;var t=this;n.a.get("libraries/",{params:{scope:"me"}}).then((function(e){t.isLoading=!1,t.libraries=e.data.results,0===t.libraries.length&&(t.hiddenForm=!1)}))},libraryCreated:function(t){this.$router.push({name:"library.detail",params:{id:t.uuid}})}}},S=w,k=Object(b["a"])(S,r,s,!1,null,null,null);e["default"]=k.exports},"45ee":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("file-upload",{ref:"fileupload",attrs:{"default-import-reference":t.defaultImportReference,library:t.object},on:{"uploads-finished":function(e){return t.$emit("uploads-finished",e)}}})],1)},s=[],i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"component-file-upload"},[a("div",{staticClass:"ui top attached tabular menu"},[a("a",{class:["item",{active:"summary"===t.currentTab}],attrs:{href:""},on:{click:function(e){e.preventDefault(),t.currentTab="summary"}}},[a("translate",{attrs:{"translate-context":"Content/Library/Tab.Title/Short"}},[t._v("Summary")])],1),a("a",{class:["item",{active:"uploads"===t.currentTab}],attrs:{href:""},on:{click:function(e){e.preventDefault(),t.currentTab="uploads"}}},[a("translate",{attrs:{"translate-context":"Content/Library/Tab.Title/Short"}},[t._v("Uploading")]),0===t.files.length?a("div",{staticClass:"ui label"},[t._v(" 0 ")]):t.files.length>t.uploadedFilesCount+t.erroredFilesCount?a("div",{staticClass:"ui warning label"},[t._v(" "+t._s(t.uploadedFilesCount+t.erroredFilesCount)+"/"+t._s(t.files.length)+" ")]):a("div",{class:["ui",{success:0===t.erroredFilesCount},{danger:t.erroredFilesCount>0},"label"]},[t._v(" "+t._s(t.uploadedFilesCount+t.erroredFilesCount)+"/"+t._s(t.files.length)+" ")])],1),a("a",{class:["item",{active:"processing"===t.currentTab}],attrs:{href:""},on:{click:function(e){e.preventDefault(),t.currentTab="processing"}}},[a("translate",{attrs:{"translate-context":"Content/Library/Tab.Title/Short"}},[t._v("Processing")]),0===t.processableFiles?a("div",{staticClass:"ui label"},[t._v(" 0 ")]):t.processableFiles>t.processedFilesCount?a("div",{staticClass:"ui warning label"},[t._v(" "+t._s(t.processedFilesCount)+"/"+t._s(t.processableFiles)+" ")]):a("div",{class:["ui",{success:0===t.uploads.errored},{danger:t.uploads.errored>0},"label"]},[t._v(" "+t._s(t.processedFilesCount)+"/"+t._s(t.processableFiles)+" ")])],1)]),a("div",{class:["ui","bottom","attached","segment",{hidden:"summary"!=t.currentTab}]},[a("h2",{staticClass:"ui header"},[a("translate",{attrs:{"translate-context":"Content/Library/Title/Verb"}},[t._v("Upload new tracks")])],1),a("div",{staticClass:"ui message"},[a("p",[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("You are about to upload music to your library. Before proceeding, please ensure that:")])],1),a("ul",["me"!=t.library.privacy_level?a("li",[a("translate",{attrs:{"translate-context":"Content/Library/List item"}},[t._v("You are not uploading copyrighted content in a public library, otherwise you may be infringing the law")])],1):t._e(),a("li",[a("translate",{attrs:{"translate-context":"Content/Library/List item"}},[t._v("The music files you are uploading are tagged properly.")]),t._v(" "),a("a",{attrs:{href:"http://picard.musicbrainz.org/",target:"_blank"}},[a("translate",{attrs:{"translate-context":"Content/Library/Link"}},[t._v("We recommend using Picard for that purpose.")])],1)],1),a("li",[a("translate",{attrs:{"translate-context":"Content/Library/List item"}},[t._v("The uploaded music files are in OGG, Flac or MP3 format")])],1)])]),a("form",{staticClass:"ui form",on:{submit:function(e){e.preventDefault(),t.currentTab="uploads"}}},[a("div",{staticClass:"fields"},[a("div",{staticClass:"ui field"},[a("label",{attrs:{for:"import-reference"}},[a("translate",{attrs:{"translate-context":"Content/Library/Input.Label/Noun"}},[t._v("Import reference")])],1),a("p",[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("This reference will be used to group imported files together.")])],1),a("input",{directives:[{name:"model",rawName:"v-model",value:t.importReference,expression:"importReference"}],attrs:{id:"import-reference",name:"import-ref",type:"text"},domProps:{value:t.importReference},on:{input:function(e){e.target.composing||(t.importReference=e.target.value)}}})])]),a("button",{staticClass:"ui success button",attrs:{type:"submit"}},[a("translate",{attrs:{"translate-context":"Content/Library/Button.Label"}},[t._v("Proceed")])],1)]),t.$store.state.auth.availablePermissions["library"]?[a("div",{staticClass:"ui divider"}),a("h2",{staticClass:"ui header"},[a("translate",{attrs:{"translate-context":"Content/Library/Title/Verb"}},[t._v("Import music from your server")])],1),t.fsErrors.length>0?a("div",{staticClass:"ui negative message",attrs:{role:"alert"}},[a("h3",{staticClass:"header"},[a("translate",{attrs:{"translate-context":"Content/*/Error message.Title"}},[t._v("Error while launching import")])],1),a("ul",{staticClass:"list"},t._l(t.fsErrors,(function(e){return a("li",[t._v(t._s(e))])})),0)]):t._e(),t.fsStatus?a("fs-browser",{attrs:{loading:t.isLoadingFs,data:t.fsStatus},on:{import:t.importFs},model:{value:t.fsPath,callback:function(e){t.fsPath=e},expression:"fsPath"}}):t._e(),t.fsStatus&&t.fsStatus.import?[a("h3",{staticClass:"ui header"},[a("translate",{attrs:{"translate-context":"Content/Library/Title/Verb"}},[t._v("Import status")])],1),t.fsStatus.import.reference!=t.importReference?a("p",[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Results of your previous import:")])],1):a("p",[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Results of your import:")])],1),"started"===t.fsStatus.import.status||"pending"===t.fsStatus.import.status?a("button",{staticClass:"ui button",on:{click:t.cancelFsScan}},[a("translate",{attrs:{"translate-context":"*/*/Button.Label/Verb"}},[t._v("Cancel")])],1):t._e(),a("fs-logs",{attrs:{data:t.fsStatus.import}})]:t._e()]:t._e()],2),a("div",{class:["ui","bottom","attached","segment",{hidden:"uploads"!=t.currentTab}]},[a("div",{class:["ui",{loading:t.isLoadingQuota},"container"]},[a("div",{class:["ui",{red:0===t.remainingSpace},{warning:t.remainingSpace>0&&t.remainingSpace<=50},"small","statistic"]},[a("div",{staticClass:"label"},[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Remaining storage space")])],1),a("div",{staticClass:"value"},[t._v(" "+t._s(t._f("humanSize")(1e3*t.remainingSpace*1e3))+" ")])]),a("file-upload-widget",{ref:"upload",class:["ui","icon","basic","button"],attrs:{"post-action":t.uploadUrl,multiple:!0,data:t.uploadData,drop:!0,extensions:t.supportedExtensions,name:"audio_file",thread:1},on:{"input-file":t.inputFile},model:{value:t.files,callback:function(e){t.files=e},expression:"files"}},[a("i",{staticClass:"upload icon"}),t._v(" "),a("translate",{attrs:{"translate-context":"Content/Library/Paragraph/Call to action"}},[t._v("Click to select files to upload or drag and drop files or directories")]),a("br"),a("br"),a("i",[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph","translate-params":{extensions:t.supportedExtensions.join(", ")}}},[t._v("Supported extensions: %{ extensions }")])],1)],1)],1),t.files.length>0?a("div",{staticClass:"table-wrapper"},[a("div",{staticClass:"ui hidden divider"}),a("table",{staticClass:"ui unstackable table"},[a("thead",[a("tr",[a("th",{staticClass:"ten wide"},[a("translate",{attrs:{"translate-context":"Content/Library/Table.Label"}},[t._v("Filename")])],1),a("th",[a("translate",{attrs:{"translate-context":"Content/*/*/Noun"}},[t._v("Size")])],1),a("th",[a("translate",{attrs:{"translate-context":"*/*/*"}},[t._v("Status")])],1),a("th",[a("translate",{attrs:{"translate-context":"*/*/*"}},[t._v("Actions")])],1)]),t.retryableFiles.length>1?a("tr",[a("th",{staticClass:"ten wide"}),a("th"),a("th"),a("th",[a("button",{staticClass:"ui right floated small basic button",on:{click:function(e){return e.preventDefault(),t.retry(t.retryableFiles)}}},[a("translate",{attrs:{"translate-context":"Content/Library/Table"}},[t._v("Retry failed uploads")])],1)])]):t._e()]),a("tbody",t._l(t.sortedFiles,(function(e,r){return a("tr",{key:e.id},[a("td",{attrs:{title:e.name}},[t._v(t._s(t._f("truncate")(e.name,60)))]),a("td",[t._v(t._s(t._f("humanSize")(e.size)))]),a("td",[e.error?a("span",{staticClass:"ui tooltip",attrs:{"data-tooltip":t.labels.tooltips[e.error]}},[a("span",{staticClass:"ui danger icon label"},[a("i",{staticClass:"question circle outline icon"}),t._v(" "+t._s(e.error)+" ")])]):e.success?a("span",{staticClass:"ui success label"},[a("translate",{key:"1",attrs:{"translate-context":"Content/Library/Table"}},[t._v("Uploaded")])],1):e.active?a("span",{staticClass:"ui warning label"},[a("translate",{key:"2",attrs:{"translate-context":"Content/Library/Table"}},[t._v("Uploading…")]),t._v(" ("+t._s(parseInt(e.progress))+"%) ")],1):a("span",{staticClass:"ui label"},[a("translate",{key:"3",attrs:{"translate-context":"Content/Library/*/Short"}},[t._v("Pending")])],1)]),a("td",[e.error?[t.retryableFiles.indexOf(e)>-1?a("button",{staticClass:"ui tiny basic icon right floated button",attrs:{title:t.labels.retry},on:{click:function(a){return a.preventDefault(),t.retry([e])}}},[a("i",{staticClass:"redo icon"})]):t._e()]:e.success?t._e():[a("button",{staticClass:"ui tiny basic danger icon right floated button",on:{click:function(a){return a.preventDefault(),t.$refs.upload.remove(e)}}},[a("i",{staticClass:"delete icon"})])]],2)])})),0)])]):t._e()]),a("div",{class:["ui","bottom","attached","segment",{hidden:"processing"!=t.currentTab}]},[a("library-files-table",{attrs:{"needs-refresh":t.needsRefresh,"ordering-config-name":"library.detail.upload",filters:{import_reference:t.importReference},"custom-objects":Object.values(t.uploads.objects)},on:{"fetch-start":function(e){t.needsRefresh=!1}}})],1)])},n=[],o=(a("4de4"),a("4160"),a("a15b"),a("d81d"),a("ac1f"),a("5319"),a("159b"),a("96cf"),a("1da1")),l=a("ceb5"),c=(a("1157"),a("bc3a")),u=a.n(c),d=(a("3677"),a("c5e3")),p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:["ui",{loading:t.loading},"segment"]},[a("div",{staticClass:"ui fluid action input"},[a("input",{staticClass:"ui disabled",attrs:{disabled:""},domProps:{value:t.data.root+"/"+t.value.join("/")}}),a("button",{staticClass:"ui button",on:{click:function(e){return e.preventDefault(),t.$emit("import")}}},[a("translate",{attrs:{"translate-context":"Content/Library/Button/Verb"}},[t._v("Import")])],1)]),a("div",{staticClass:"ui list component-fs-browser"},[t.value.length>0?a("a",{staticClass:"item",attrs:{href:""},on:{click:function(e){return e.preventDefault(),t.handleClick({name:"..",dir:!0})}}},[a("i",{staticClass:"folder icon"}),t._m(0)]):t._e(),t._l(t.data.content,(function(e){return a("a",{key:e.name,staticClass:"item",attrs:{href:""},on:{click:function(a){return a.preventDefault(),t.handleClick(e)}}},[e.dir?a("i",{staticClass:"folder icon"}):a("i",{staticClass:"file icon"}),a("div",{staticClass:"content"},[a("div",{staticClass:"header"},[t._v(t._s(e.name))])])])}))],2)])},b=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("div",{staticClass:"header"},[t._v("..")])])}],h=(a("99af"),a("b0c0"),a("2909")),f={props:["data","loading","value"],methods:{handleClick:function(t){if(t.dir)if(".."===t.name){var e=Object(h["a"])(this.value);e.pop(),this.$emit("input",e)}else this.$emit("input",[].concat(Object(h["a"])(this.value),[t.name]))}}},v=f,m=a("2877"),g=Object(m["a"])(v,p,b,!1,null,null,null),y=g.exports,_=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ui segment component-fs-logs"},["pending"===t.data.status?a("div",{staticClass:"ui active dimmer"},[a("div",{staticClass:"ui text loader"},[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Import hasn't started yet")])],1)]):t._l(t.data.logs,(function(e,r){return[a("p",{key:r},[t._v(t._s(e))])]}))],2)},C=[],L={props:["data"]},x=L,w=Object(m["a"])(x,_,C,!1,null,null,null),S=w.exports,k=a("a518"),F=a("c1df"),P=a.n(F),$={props:["library","defaultImportReference"],components:{FileUploadWidget:d["a"],LibraryFilesTable:k["a"],FsBrowser:y,FsLogs:S},data:function(){var t=this.defaultImportReference||P()().format();return this.$router.replace({query:{import:t}}),{files:[],needsRefresh:!1,currentTab:"summary",uploadUrl:this.$store.getters["instance/absoluteUrl"]("/api/v1/uploads/"),importReference:t,isLoadingQuota:!1,quotaStatus:null,uploads:{pending:0,finished:0,skipped:0,errored:0,objects:{}},processTimestamp:new Date,fsStatus:null,fsPath:[],isLoadingFs:!1,fsInterval:null,fsErrors:[]}},created:function(){var t=this;this.fetchStatus(),this.$store.state.auth.availablePermissions["library"]&&(this.fetchFs(!0),this.fsInterval=setInterval((function(){t.fetchFs(!1)}),5e3)),this.fetchQuota(),this.$store.commit("ui/addWebsocketEventHandler",{eventName:"import.status_updated",id:"fileUpload",handler:this.handleImportEvent}),window.onbeforeunload=function(e){return t.onBeforeUnload(e)}},destroyed:function(){this.$store.commit("ui/removeWebsocketEventHandler",{eventName:"import.status_updated",id:"fileUpload"}),window.onbeforeunload=null,this.fsInterval&&clearInterval(this.fsInterval)},methods:{onBeforeUnload:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="This page is asking you to confirm that you want to leave - data you have entered may not be saved.";return this.hasActiveUploads?(Object.assign(t,{returnValue:e}),e):null},fetchQuota:function(){var t=this;t.isLoadingQuota=!0,u.a.get("users/me/").then((function(e){t.quotaStatus=e.data.quota_status,t.isLoadingQuota=!1}))},fetchFs:function(t){var e=this;t&&(e.isLoadingFs=!0),u.a.get("libraries/fs-import",{params:{path:this.fsPath.join("/")}}).then((function(a){e.fsStatus=a.data,t&&(e.isLoadingFs=!1)}))},importFs:function(){var t=this;t.isLoadingFs=!0;var e={path:this.fsPath.join("/"),library:this.library.uuid,import_reference:this.importReference};u.a.post("libraries/fs-import",e).then((function(e){t.fsStatus=e.data,t.isLoadingFs=!1}),(function(e){t.isLoadingFs=!1,t.fsErrors=e.backendErrors}))},cancelFsScan:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u.a.delete("libraries/fs-import");case 2:t.fetchFs();case 3:case"end":return e.stop()}}),e)})))()},inputFile:function(t,e){t&&(this.remainingSpace<t.size/1e6?t.error="denied":this.$refs.upload.active=!0)},fetchStatus:function(){var t=this,e=["pending","errored","skipped","finished"];e.forEach((function(e){u.a.get("uploads/",{params:{import_reference:t.importReference,import_status:e,page_size:1}}).then((function(a){t.uploads[e]=a.data.count}))}))},handleImportEvent:function(t){var e=this;t.upload.import_reference==e.importReference&&this.$nextTick((function(){e.uploads[t.old_status]-=1,e.uploads[t.new_status]+=1,e.uploads.objects[t.upload.uuid]=t.upload,e.needsRefresh=!0}))},retry:function(t){var e=this;t.forEach((function(t){e.$refs.upload.update(t,{error:"",progress:"0.00"})})),this.$refs.upload.active=!0}},computed:{supportedExtensions:function(){return this.$store.state.ui.supportedExtensions},labels:function(){var t=this.$pgettext("Content/Library/Help text","Upload denied, ensure the file is not too big and that you have not reached your quota"),e=this.$pgettext("Content/Library/Help text","Cannot upload this file, ensure it is not too big"),a=this.$pgettext("Content/Library/Help text","A network error occurred while uploading this file"),r=this.$pgettext("Content/Library/Help text","Upload timeout, please try again"),s=this.$pgettext("Content/Library/Help text","Invalid file type, ensure you are uploading an audio file. Supported file extensions are %{ extensions }");return{tooltips:{denied:t,server:e,network:a,timeout:r,retry:this.$pgettext("*/*/*/Verb","Retry"),extension:this.$gettextInterpolate(s,{extensions:this.supportedExtensions.join(", ")})}}},uploadedFilesCount:function(){return this.files.filter((function(t){return t.success})).length},uploadingFilesCount:function(){return this.files.filter((function(t){return!t.success&&!t.error})).length},erroredFilesCount:function(){return this.files.filter((function(t){return t.error})).length},retryableFiles:function(){return this.files.filter((function(t){return t.error}))},processableFiles:function(){return this.uploads.pending+this.uploads.skipped+this.uploads.errored+this.uploads.finished+this.uploadedFilesCount},processedFilesCount:function(){return this.uploads.skipped+this.uploads.errored+this.uploads.finished},uploadData:function(){return{library:this.library.uuid,import_reference:this.importReference}},sortedFiles:function(){return l["a"].sortBy(this.files.map((function(t){var e=0;return t.errored&&(e=-1),t.success&&(e=1),t.statusIndex=e,t})),["statusIndex","name"])},hasActiveUploads:function(){return this.sortedFiles.filter((function(t){return t.active})).length>0},remainingSpace:function(){return this.quotaStatus?Math.max(0,this.quotaStatus.remaining-this.uploadedSize/1e6):0},uploadedSize:function(){var t=0;return this.files.forEach((function(e){e.error||(t+=e.size*(e.progress/100))})),t}},watch:{importReference:l["a"].debounce((function(){this.$router.replace({query:{import:this.importReference}})}),500),remainingSpace:function(t){t<=0&&(this.$refs.upload.active=!1)},"uploads.finished":function(t,e){t>e&&this.$emit("uploads-finished",t-e)},fsPath:function(){this.fetchFs(!0)}}},j=$,T=Object(m["a"])(j,i,n,!1,null,null,null),D=T.exports,q={props:["object","defaultImportReference"],components:{FileUpload:D},beforeRouteLeave:function(t,e,a){if(this.$refs.fileupload.hasActiveUploads){var r=window.confirm("This page is asking you to confirm that you want to leave - data you have entered may not be saved.");r?a():a(!1)}else a()}},R=q,V=Object(m["a"])(R,r,s,!1,null,null,null);e["default"]=V.exports},"4d83":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"ui vertical aligned stripe segment"},[a("library-files-table",{attrs:{"default-query":t.query}})],1)},s=[],i=a("a518"),n={props:["query"],components:{LibraryFilesTable:i["a"]}},o=n,l=a("2877"),c=Object(l["a"])(o,r,s,!1,null,null,null);e["default"]=c.exports},a518:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"ui inline form"},[a("div",{staticClass:"fields"},[a("div",{staticClass:"ui six wide field"},[a("label",{attrs:{for:"files-search"}},[a("translate",{attrs:{"translate-context":"Content/Search/Input.Label/Noun"}},[t._v("Search")])],1),a("form",{on:{submit:function(e){e.preventDefault(),t.search.query=t.$refs.search.value}}},[a("input",{ref:"search",attrs:{name:"search",type:"text",id:"files-search",placeholder:t.labels.searchPlaceholder},domProps:{value:t.search.query}})])]),a("div",{staticClass:"field"},[a("label",{attrs:{for:"import-status"}},[a("translate",{attrs:{"translate-context":"Content/*/*/Noun"}},[t._v("Import status")])],1),a("select",{staticClass:"ui dropdown",attrs:{id:"import-status"},domProps:{value:t.getTokenValue("status","")},on:{change:function(e){return t.addSearchToken("status",e.target.value)}}},[a("option",{attrs:{value:""}},[a("translate",{attrs:{"translate-context":"Content/*/Dropdown"}},[t._v("All")])],1),a("option",{attrs:{value:"draft"}},[a("translate",{attrs:{"translate-context":"Content/Library/*/Short"}},[t._v("Draft")])],1),a("option",{attrs:{value:"pending"}},[a("translate",{attrs:{"translate-context":"Content/Library/*/Short"}},[t._v("Pending")])],1),a("option",{attrs:{value:"skipped"}},[a("translate",{attrs:{"translate-context":"Content/Library/*"}},[t._v("Skipped")])],1),a("option",{attrs:{value:"errored"}},[a("translate",{attrs:{"translate-context":"Content/Library/Dropdown"}},[t._v("Failed")])],1),a("option",{attrs:{value:"finished"}},[a("translate",{attrs:{"translate-context":"Content/Library/*"}},[t._v("Finished")])],1)])]),a("div",{staticClass:"field"},[a("label",{attrs:{for:"ordering-select"}},[a("translate",{attrs:{"translate-context":"Content/Search/Dropdown.Label/Noun"}},[t._v("Ordering")])],1),a("select",{directives:[{name:"model",rawName:"v-model",value:t.ordering,expression:"ordering"}],staticClass:"ui dropdown",attrs:{id:"ordering-select"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.ordering=e.target.multiple?a:a[0]}}},t._l(t.orderingOptions,(function(e){return a("option",{domProps:{value:e[0]}},[t._v(t._s(t.sharedLabels.filters[e[1]]))])})),0)]),a("div",{staticClass:"field"},[a("label",{attrs:{for:"ordering-direction"}},[a("translate",{attrs:{"translate-context":"Content/Search/Dropdown.Label/Noun"}},[t._v("Ordering direction")])],1),a("select",{directives:[{name:"model",rawName:"v-model",value:t.orderingDirection,expression:"orderingDirection"}],staticClass:"ui dropdown",attrs:{id:"ordering-direction"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.orderingDirection=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:"+"}},[a("translate",{attrs:{"translate-context":"Content/Search/Dropdown"}},[t._v("Ascending")])],1),a("option",{attrs:{value:"-"}},[a("translate",{attrs:{"translate-context":"Content/Search/Dropdown"}},[t._v("Descending")])],1)])])])]),a("import-status-modal",{attrs:{upload:t.detailedUpload,show:t.showUploadDetailModal},on:{"update:show":function(e){t.showUploadDetailModal=e}}}),a("div",{staticClass:"dimmable"},[t.isLoading?a("div",{staticClass:"ui active inverted dimmer"},[a("div",{staticClass:"ui loader"})]):t.result||0!==t.result.results.length||t.needsRefresh?a("action-table",{attrs:{"id-field":"uuid","objects-data":t.result,"custom-objects":t.customObjects,actions:t.actions,refreshable:!0,"needs-refresh":t.needsRefresh,"action-url":"uploads/action/",filters:t.actionFilters},on:{"action-launched":t.fetchData,refresh:t.fetchData},scopedSlots:t._u([{key:"row-cells",fn:function(e){return[e.obj.track?[a("td",[a("router-link",{attrs:{to:{name:"library.tracks.detail",params:{id:e.obj.track.id}}}},[t._v(" "+t._s(t._f("truncate")(e.obj.track.title,25))+" ")])],1),a("td",[a("a",{staticClass:"discrete link",attrs:{href:""},on:{click:function(a){return a.preventDefault(),t.addSearchToken("artist",e.obj.track.artist.name)}}},[t._v(t._s(t._f("truncate")(e.obj.track.artist.name,20)))])]),a("td",[e.obj.track.album?a("a",{staticClass:"discrete link",attrs:{href:""},on:{click:function(a){return a.preventDefault(),t.addSearchToken("album",e.obj.track.album.title)}}},[t._v(t._s(t._f("truncate")(e.obj.track.album.title,20)))]):t._e()])]:[a("td",{attrs:{title:e.obj.source}},[t._v(t._s(t._f("truncate")(e.obj.source,25)))]),a("td"),a("td")],a("td",[a("human-date",{attrs:{date:e.obj.creation_date}})],1),a("td",[a("a",{staticClass:"discrete link",attrs:{href:"",title:t.sharedLabels.fields.import_status.choices[e.obj.import_status].help},on:{click:function(a){return a.preventDefault(),t.addSearchToken("status",e.obj.import_status)}}},[t._v(t._s(t.sharedLabels.fields.import_status.choices[e.obj.import_status].label))]),a("button",{staticClass:"ui tiny basic icon button",attrs:{title:t.sharedLabels.fields.import_status.detailTitle,"aria-label":t.labels.showStatus},on:{click:function(a){t.detailedUpload=e.obj,t.showUploadDetailModal=!0}}},[a("i",{staticClass:"question circle outline icon"})])]),e.obj.duration?a("td",[t._v(t._s(t._f("duration")(e.obj.duration)))]):a("td",[a("translate",{attrs:{"translate-context":"*/*/*"}},[t._v("N/A")])],1),e.obj.size?a("td",[t._v(t._s(t._f("humanSize")(e.obj.size)))]):a("td",[a("translate",{attrs:{"translate-context":"*/*/*"}},[t._v("N/A")])],1)]}}])},[a("template",{slot:"header-cells"},[a("th",[a("translate",{attrs:{"translate-context":"*/*/*/Noun"}},[t._v("Title")])],1),a("th",[a("translate",{attrs:{"translate-context":"*/*/*/Noun"}},[t._v("Artist")])],1),a("th",[a("translate",{attrs:{"translate-context":"*/*/*"}},[t._v("Album")])],1),a("th",[a("translate",{attrs:{"translate-context":"*/*/*/Noun"}},[t._v("Upload date")])],1),a("th",[a("translate",{attrs:{"translate-context":"Content/*/*/Noun"}},[t._v("Import status")])],1),a("th",[a("translate",{attrs:{"translate-context":"Content/*/*"}},[t._v("Duration")])],1),a("th",[a("translate",{attrs:{"translate-context":"Content/*/*/Noun"}},[t._v("Size")])],1)])],2):a("div",{staticClass:"ui placeholder segment"},[a("div",{staticClass:"ui icon header"},[a("i",{staticClass:"upload icon"}),a("translate",{attrs:{"translate-context":"Content/Home/Placeholder"}},[t._v("No tracks have been added to this library yet")])],1)])],1),a("div",[t.result&&t.result.count>t.paginateBy?a("pagination",{attrs:{compact:!0,current:t.page,"paginate-by":t.paginateBy,total:t.result.count},on:{"page-changed":function(e){t.page=e,t.fetchData()}}}):t._e(),t.result&&t.result.results.length>0?a("span",[a("translate",{attrs:{"translate-context":"Content/*/Paragraph","translate-params":{start:(t.page-1)*t.paginateBy+1,end:(t.page-1)*t.paginateBy+t.result.results.length,total:t.result.count}}},[t._v("Showing results %{ start }-%{ end } on %{ total }")])],1):t._e()],1)],1)},s=[],i=(a("ac1f"),a("841c"),a("bc3a")),n=a.n(i),o=a("ceb5"),l=a("cadb"),c=a("3255"),u=a("1799"),d=a("414c"),p=a("20be"),b=a("64c4"),h=a("8bad"),f=a("fe5e"),v={mixins:[p["a"],b["a"],h["a"]],props:{filters:{type:Object,required:!1},needsRefresh:{type:Boolean,required:!1,default:!1},customObjects:{type:Array,required:!1,default:function(){return[]}}},components:{Pagination:u["a"],ActionTable:d["a"],ImportStatusModal:f["a"]},data:function(){return{time:l["a"],detailedUpload:null,showUploadDetailModal:!1,isLoading:!1,result:null,page:1,search:{query:this.defaultQuery,tokens:Object(c["c"])(Object(c["b"])(this.defaultQuery))},orderingOptions:[["creation_date","creation_date"],["title","track_title"],["size","size"],["duration","duration"],["bitrate","bitrate"],["album_title","album_title"],["artist_name","artist_name"]]}},created:function(){this.fetchData()},methods:{fetchData:function(){this.$emit("fetch-start");var t=o["a"].merge({page:this.page,page_size:this.paginateBy,ordering:this.getOrderingAsString(),q:this.search.query,include_channels:"true"},this.filters||{}),e=this;e.isLoading=!0,e.checked=[],n.a.get("/uploads/",{params:t}).then((function(t){e.result=t.data,e.isLoading=!1}),(function(t){e.isLoading=!1,e.errors=t.backendErrors}))}},computed:{labels:function(){return{searchPlaceholder:this.$pgettext("Content/Library/Input.Placeholder","Search by title, artist, album…"),showStatus:this.$pgettext("Content/Library/Button.Label/Verb","Show information about the upload status for this track")}},actionFilters:function(){var t={q:this.search.query,include_channels:"true"};return this.filters?o["a"].merge(t,this.filters):t},actions:function(){var t=this.$pgettext("*/*/*/Verb","Delete"),e=this.$pgettext("Content/Library/Dropdown/Verb","Restart import");return[{name:"delete",label:t,isDangerous:!0,allowAll:!0},{name:"relaunch_import",label:e,isDangerous:!0,allowAll:!0,filterCheckable:function(t){return"finished"!=t.import_status}}]}},watch:{orderingDirection:function(){this.page=1,this.fetchData()},page:function(){this.fetchData()},ordering:function(){this.page=1,this.fetchData()},search:function(t){this.page=1,this.fetchData()}}},m=v,g=a("2877"),y=Object(g["a"])(m,r,s,!1,null,null,null);e["a"]=y.exports},add5:function(t,e,a){"use strict";a("b0c0");var r,s,i={methods:{getReportableObjs:function(t){var e=t.track,a=t.album,r=t.artist,s=t.playlist,i=t.account,n=t.library,o=t.channel,l=[];if(i){var c=this.$pgettext("*/Moderation/*/Verb","Report @%{ username }…");l.push({label:this.$gettextInterpolate(c,{username:i.preferred_username}),target:{type:"account",_obj:i,full_username:i.full_username,label:i.full_username,typeLabel:this.$pgettext("*/*/*/Noun","Account")}}),e&&(a=e.album,r=e.artist)}return e&&(l.push({label:this.$pgettext("*/Moderation/*/Verb","Report this track…"),target:{type:"track",id:e.id,_obj:e,label:e.title,typeLabel:this.$pgettext("*/*/*/Noun","Track")}}),a=e.album,r=e.artist),a&&(l.push({label:this.$pgettext("*/Moderation/*/Verb","Report this album…"),target:{type:"album",id:a.id,label:a.title,_obj:a,typeLabel:this.$pgettext("*/*/*","Album")}}),r||(r=a.artist)),o?l.push({label:this.$pgettext("*/Moderation/*/Verb","Report this channel…"),target:{type:"channel",uuid:o.uuid,label:o.artist.name,_obj:o,typeLabel:this.$pgettext("*/*/*","Channel")}}):r&&l.push({label:this.$pgettext("*/Moderation/*/Verb","Report this artist…"),target:{type:"artist",id:r.id,label:r.name,_obj:r,typeLabel:this.$pgettext("*/*/*/Noun","Artist")}}),s&&l.push({label:this.$pgettext("*/Moderation/*/Verb","Report this playlist…"),target:{type:"playlist",id:s.id,label:s.name,_obj:s,typeLabel:this.$pgettext("*/*/*","Playlist")}}),n&&l.push({label:this.$pgettext("*/Moderation/*/Verb","Report this library…"),target:{type:"library",uuid:n.uuid,label:n.name,_obj:n,typeLabel:this.$pgettext("*/*/*/Noun","Library")}}),l}}},n=i,o=a("2877"),l=Object(o["a"])(n,r,s,!1,null,null,null);e["a"]=l.exports},bbfd:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ui vertical aligned stripe segment"},[t.isLoading?a("div",{class:["ui",{active:t.isLoading},"inverted","dimmer"]},[a("div",{staticClass:"ui text loader"},[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Loading remote libraries…")])],1)]):a("div",{staticClass:"ui text container"},[a("h1",{staticClass:"ui header"},[a("translate",{attrs:{"translate-context":"Content/Library/Title/Noun"}},[t._v("Remote libraries")])],1),a("p",[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Remote libraries are owned by other users on the network. You can access them as long as they are public or you are granted access.")])],1),a("scan-form",{on:{scanned:function(e){t.scanResult=e}}}),a("div",{staticClass:"ui hidden divider"}),t.scanResult&&t.scanResult.results.length>0?a("div",{staticClass:"ui two cards"},t._l(t.scanResult.results,(function(t){return a("library-card",{key:t.fid,attrs:{library:t}})})),1):t._e(),t.existingFollows&&t.existingFollows.count>0?[a("h2",[a("translate",{attrs:{"translate-context":"Content/Library/Title"}},[t._v("Known libraries")])],1),a("a",{staticClass:"discrete link",attrs:{href:""},on:{click:function(e){return e.preventDefault(),t.fetch()}}},[a("i",{class:["ui","circular","refresh","icon"]}),t._v(" "),a("translate",{attrs:{"translate-context":"Content/*/Button.Label/Short, Verb"}},[t._v("Refresh")])],1),a("div",{staticClass:"ui hidden divider"}),a("div",{staticClass:"ui two cards"},t._l(t.existingFollows.results,(function(e){return a("library-card",{key:e.fid,attrs:{library:t.getLibraryFromFollow(e)},on:{deleted:function(e){return t.fetch()},followed:function(e){return t.fetch()}}})})),1)]:t._e()],2)])},s=[],i=(a("4160"),a("159b"),a("bc3a")),n=a.n(i),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("form",{staticClass:"ui form",on:{submit:function(e){return e.preventDefault(),t.scan(e)}}},[t.errors.length>0?a("div",{staticClass:"ui negative message",attrs:{role:"alert"}},[a("h4",{staticClass:"header"},[a("translate",{attrs:{"translate-context":"Content/Library/Error message.Title"}},[t._v("Could not fetch remote library")])],1),a("ul",{staticClass:"list"},t._l(t.errors,(function(e){return a("li",[t._v(t._s(e))])})),0)]):t._e(),a("div",{staticClass:"ui field"},[a("label",{attrs:{for:"library-search"}},[a("translate",{attrs:{"translate-context":"Content/Library/Input.Label/Verb"}},[t._v("Search a remote library")])],1),a("div",{class:["ui","action",{loading:t.isLoading},"input"]},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.query,expression:"query"}],attrs:{id:"library-search",name:"url",placeholder:t.labels.placeholder,type:"url"},domProps:{value:t.query},on:{input:function(e){e.target.composing||(t.query=e.target.value)}}}),a("button",{class:["ui","icon",{loading:t.isLoading},"button"],attrs:{"aria-label":t.labels.submitLibrarySearch,type:"submit"}},[a("i",{staticClass:"search icon"})])])])])},l=[],c={data:function(){return{query:"",isLoading:!1,errors:[]}},methods:{scan:function(){if(this.query){var t=this;t.errors=[],t.isLoading=!0,n.a.post("federation/libraries/fetch/",{fid:this.query}).then((function(e){t.$emit("scanned",e.data),t.isLoading=!1}),(function(e){t.isLoading=!1,t.errors=e.backendErrors}))}}},computed:{labels:function(){return{placeholder:this.$pgettext("Content/Library/Input.Placeholder","Enter a library URL"),submitLibrarySearch:this.$pgettext("Content/Library/Input.Label","Submit search")}}}},u=c,d=a("2877"),p=Object(d["a"])(u,o,l,!1,null,null,null),b=p.exports,h=a("c395"),f={data:function(){return{isLoading:!1,scanResult:null,existingFollows:null}},created:function(){this.fetch()},components:{ScanForm:b,LibraryCard:h["a"]},methods:{fetch:function(){this.isLoading=!0;var t=this;n.a.get("federation/follows/library/",{params:{page_size:100,ordering:"-creation_date"}}).then((function(e){t.existingFollows=e.data,t.existingFollows.results.forEach((function(t){t.target.follow=t})),t.isLoading=!1}),(function(e){t.isLoading=!1}))},getLibraryFromFollow:function(t){var e=t.target;return e.follow=t,e}}},v=f,m=Object(d["a"])(v,r,s,!1,null,null,null);e["default"]=m.exports},c395:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ui card"},[a("div",{staticClass:"content"},[a("h4",{staticClass:"header"},[a("router-link",{attrs:{to:{name:"library.detail",params:{id:t.library.uuid}}}},[t._v(" "+t._s(t.library.name)+" ")]),a("div",{directives:[{name:"dropdown",rawName:"v-dropdown"}],staticClass:"ui right floated dropdown"},[a("i",{staticClass:"ellipsis vertical large icon nomargin"}),a("div",{staticClass:"menu"},t._l(t.getReportableObjs({library:t.library,account:t.library.actor}),(function(e){return a("button",{key:e.target.type+e.target.id,staticClass:"item basic",on:{click:function(a){return a.stopPropagation(),a.preventDefault(),t.$store.dispatch("moderation/report",e.target)}}},[a("i",{staticClass:"share icon"}),t._v(" "+t._s(e.label)+" ")])})),0)]),"me"===t.library.privacy_level?a("span",{staticClass:"right floated",attrs:{"data-tooltip":t.labels.tooltips.me}},[a("i",{staticClass:"small lock icon"})]):"everyone"===t.library.privacy_level?a("span",{staticClass:"right floated",attrs:{"data-tooltip":t.labels.tooltips.everyone}},[a("i",{staticClass:"small globe icon"})]):t._e()],1),a("div",{staticClass:"meta"},[a("span",[a("i",{staticClass:"small outline clock icon"}),a("human-date",{attrs:{date:t.library.creation_date}})],1)]),a("div",{staticClass:"description"},[t._v(" "+t._s(t.library.description)+" "),a("div",{staticClass:"ui hidden divider"})]),a("div",{staticClass:"meta"},[a("i",{staticClass:"music icon"}),a("translate",{attrs:{"translate-context":"*/*/*","translate-params":{count:t.library.uploads_count},"translate-n":t.library.uploads_count,"translate-plural":"%{ count } tracks"}},[t._v("%{ count } track")])],1),t.displayScan&&t.latestScan?a("div",{staticClass:"meta"},["pending"===t.latestScan.status?[a("i",{staticClass:"hourglass icon"}),a("translate",{attrs:{"translate-context":"Content/Library/Card.List item"}},[t._v("Scan pending")])]:t._e(),"scanning"===t.latestScan.status?[a("i",{staticClass:"loading spinner icon"}),a("translate",{attrs:{"translate-context":"Content/Library/Card.List item","translate-params":{progress:t.scanProgress}}},[t._v("Scanning… (%{ progress }%)")])]:"errored"===t.latestScan.status?[a("i",{staticClass:"dangerdownload icon"}),a("translate",{attrs:{"translate-context":"Content/Library/Card.List item"}},[t._v("Problem during scanning")])]:"finished"===t.latestScan.status&&0===t.latestScan.errored_files?[a("i",{staticClass:"success download icon"}),a("translate",{attrs:{"translate-context":"Content/Library/Card.List item"}},[t._v("Scanned")])]:"finished"===t.latestScan.status&&t.latestScan.errored_files>0?[a("i",{staticClass:"warning download icon"}),a("translate",{attrs:{"translate-context":"Content/Library/Card.List item"}},[t._v("Scanned with errors")])]:t._e(),a("a",{staticClass:"link right floated",attrs:{href:""},on:{click:function(e){e.preventDefault(),t.showScan=!t.showScan}}},[a("translate",{attrs:{"translate-context":"Content/Library/Card.Button.Label/Noun"}},[t._v("Details")]),t.showScan?a("i",{staticClass:"angle down icon"}):a("i",{staticClass:"angle right icon"})],1),t.showScan?a("div",[t.latestScan.modification_date?[a("translate",{attrs:{"translate-context":"Content/Library/Card.List item/Noun"}},[t._v("Last update:")]),a("human-date",{attrs:{date:t.latestScan.modification_date}}),a("br")]:t._e(),a("translate",{attrs:{"translate-context":"Content/Library/Card.List item/Noun"}},[t._v("Failed tracks:")]),t._v(" "+t._s(t.latestScan.errored_files)+" ")],2):t._e()],2):t._e(),t.displayScan&&t.canLaunchScan?a("div",{staticClass:"clearfix"},[a("a",{staticClass:"right floated link",attrs:{href:""},on:{click:function(e){return e.preventDefault(),t.launchScan(e)}}},[a("translate",{attrs:{"translate-context":"Content/Library/Card.Button.Label/Verb"}},[t._v("Scan now")]),t._v(" "),a("i",{staticClass:"paper plane icon"})],1)]):t._e()]),a("div",{staticClass:"extra content"},[a("actor-link",{staticStyle:{color:"var(--link-color)"},attrs:{actor:t.library.actor}})],1),t.displayCopyFid?a("div",{staticClass:"extra content"},[a("div",{staticClass:"ui form"},[a("div",{staticClass:"field"},[a("label",{attrs:{for:t.library.fid}},[a("translate",{attrs:{"translate-context":"Content/Library/Title"}},[t._v("Sharing link")])],1),a("copy-input",{attrs:{id:t.library.fid,"button-classes":"basic",value:t.library.fid}})],1)])]):t._e(),t.displayFollow||t.radioPlayable?a("div",{class:["ui",{two:t.displayFollow&&t.radioPlayable},"bottom","attached","buttons"]},[t.radioPlayable?a("radio-button",{attrs:{type:"library","object-id":t.library.uuid}}):t._e(),t.displayFollow?[t.library.follow?t.library.follow.approved?t.library.follow.approved?[a("dangerous-button",{class:["ui","button"],attrs:{action:t.unfollow}},[a("translate",{attrs:{"translate-context":"*/Library/Button.Label/Verb"}},[t._v("Unfollow")]),a("p",{attrs:{slot:"modal-header"},slot:"modal-header"},[a("translate",{attrs:{"translate-context":"Popup/Library/Title"}},[t._v("Unfollow this library?")])],1),a("div",{attrs:{slot:"modal-content"},slot:"modal-content"},[a("p",[a("translate",{attrs:{"translate-context":"Popup/Library/Paragraph"}},[t._v("By unfollowing this library, you loose access to its content.")])],1)]),a("div",{attrs:{slot:"modal-confirm"},slot:"modal-confirm"},[a("translate",{attrs:{"translate-context":"*/Library/Button.Label/Verb"}},[t._v("Unfollow")])],1)],1)]:t._e():[a("button",{staticClass:"ui disabled button"},[a("i",{staticClass:"hourglass icon"}),a("translate",{attrs:{"translate-context":"Content/Library/Card.Paragraph"}},[t._v("Follow request pending approval")])],1),a("button",{staticClass:"ui button",on:{click:t.unfollow}},[a("translate",{attrs:{"translate-context":"Content/Library/Card.Paragraph"}},[t._v("Cancel follow request")])],1)]:a("button",{class:["ui","success",{loading:t.isLoadingFollow},"button"],on:{click:function(e){return t.follow()}}},[a("translate",{attrs:{"translate-context":"Content/Library/Card.Button.Label/Verb"}},[t._v("Follow")])],1)]:t._e()],2):t._e()])},s=[],i=(a("e25e"),a("bc3a")),n=a.n(i),o=a("add5"),l=a("d4fd"),c=(a("1157"),{mixins:[o["a"]],props:{library:{type:Object,required:!0},displayFollow:{type:Boolean,default:!0},displayScan:{type:Boolean,default:!0},displayCopyFid:{type:Boolean,default:!0}},components:{RadioButton:l["a"]},data:function(){return{isLoadingFollow:!1,showScan:!1,scanTimeout:null,latestScan:this.library.latest_scan}},computed:{labels:function(){var t=this.$pgettext("Content/Library/Card.Help text","This library is private and your approval from its owner is needed to access its content"),e=this.$pgettext("Content/Library/Card.Help text","This library is public and you can access its content freely");return{tooltips:{me:t,everyone:e}}},scanProgress:function(){var t=this.latestScan,e=100*t.processed_files/t.total_files;return Math.min(parseInt(e),100)},scanStatus:function(){return this.latestScan?this.latestScan.status:"unknown"},canLaunchScan:function(){return"pending"!==this.scanStatus&&"scanning"!==this.scanStatus},radioPlayable:function(){return(this.library.actor.is_local||"finished"===this.scanStatus)&&("everyone"===this.library.privacy_level||this.library.follow&&this.library.follow.is_approved)}},methods:{launchScan:function(){var t=this,e=this.$pgettext("Content/Library/Message","Scan launched"),a=this.$pgettext("Content/Library/Message","Scan skipped (previous scan is too recent)");n.a.post("federation/libraries/".concat(this.library.uuid,"/scan/")).then((function(r){var s;"skipped"==r.data.status?s=a:(t.latestScan=r.data.scan,s=e),t.$store.commit("ui/addMessage",{content:s,date:new Date})}))},follow:function(){var t=this;this.isLoadingFollow=!0,n.a.post("federation/follows/library/",{target:this.library.uuid}).then((function(e){t.library.follow=e.data,t.isLoadingFollow=!1,t.$emit("followed")}),(function(e){t.isLoadingFollow=!1}))},unfollow:function(){var t=this;this.isLoadingFollow=!0,n.a.delete("federation/follows/library/".concat(this.library.follow.uuid,"/")).then((function(e){t.$emit("deleted"),t.library.follow=null,t.isLoadingFollow=!1}),(function(e){t.isLoadingFollow=!1}))},fetchScanStatus:function(){var t=this;n.a.get("federation/follows/library/".concat(this.library.follow.uuid,"/")).then((function(e){t.latestScan=e.data.target.latest_scan,"pending"===t.scanStatus||"scanning"===t.scanStatus?t.scanTimeout=setTimeout(t.fetchScanStatus(),5e3):clearTimeout(t.scanTimeout)}))}},watch:{showScan:function(t,e){t?"pending"!==this.scanStatus&&"scanning"!==this.scanStatus||this.fetchScanStatus():this.scanTimeout&&clearTimeout(this.scanTimeout)}}}),u=c,d=a("2877"),p=Object(d["a"])(u,r,s,!1,null,null,null);e["a"]=p.exports},c8c3:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("library-form",{attrs:{library:t.object},on:{updated:function(e){return t.$emit("updated")},deleted:function(e){return t.$router.push({name:"profile.overview",params:{username:t.$store.state.auth.username}})}}}),a("div",{staticClass:"ui hidden divider"}),a("h2",{staticClass:"ui header"},[a("translate",{attrs:{"translate-context":"*/*/*"}},[t._v("Library contents")])],1),a("library-files-table",{attrs:{filters:{library:t.object.uuid}}}),a("div",{staticClass:"ui hidden divider"}),a("h2",{staticClass:"ui header"},[a("translate",{attrs:{"translate-context":"Content/Federation/*/Noun"}},[t._v("Followers")])],1),t.isLoadingFollows?a("div",{class:["ui",{active:t.isLoadingFollows},"inverted","dimmer"]},[a("div",{staticClass:"ui text loader"},[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Loading followers…")])],1)]):t.follows&&t.follows.count>0?a("table",{staticClass:"ui table"},[a("thead",[a("tr",[a("th",[a("translate",{attrs:{"translate-context":"Content/Library/Table.Label"}},[t._v("User")])],1),a("th",[a("translate",{attrs:{"translate-context":"Content/Library/Table.Label"}},[t._v("Date")])],1),a("th",[a("translate",{attrs:{"translate-context":"*/*/*"}},[t._v("Status")])],1),a("th",[a("translate",{attrs:{"translate-context":"Content/Library/Table.Label"}},[t._v("Action")])],1)])]),t._l(t.follows.results,(function(e){return a("tr",{key:e.fid},[a("td",[a("actor-link",{attrs:{actor:e.actor}})],1),a("td",[a("human-date",{attrs:{date:e.creation_date}})],1),a("td",[null===e.approved?a("span",{class:["ui","warning","basic","label"]},[a("translate",{attrs:{"translate-context":"Content/Library/Table/Short"}},[t._v("Pending approval")])],1):!0===e.approved?a("span",{class:["ui","success","basic","label"]},[a("translate",{attrs:{"translate-context":"Content/Library/Table/Short"}},[t._v("Accepted")])],1):!1===e.approved?a("span",{class:["ui","danger","basic","label"]},[a("translate",{attrs:{"translate-context":"Content/Library/*/Short"}},[t._v("Rejected")])],1):t._e()]),a("td",[null===e.approved||!1===e.approved?a("button",{class:["ui","mini","icon","labeled","success","button"],on:{click:function(a){return t.updateApproved(e,!0)}}},[a("i",{staticClass:"ui check icon"}),t._v(" "),a("translate",{attrs:{"translate-context":"Content/Library/Button.Label"}},[t._v("Accept")])],1):t._e(),null===e.approved||!0===e.approved?a("button",{class:["ui","mini","icon","labeled","danger","button"],on:{click:function(a){return t.updateApproved(e,!1)}}},[a("i",{staticClass:"ui x icon"}),t._v(" "),a("translate",{attrs:{"translate-context":"Content/Library/Button.Label"}},[t._v("Reject")])],1):t._e()])])}))],2):a("p",[a("translate",{attrs:{"translate-context":"Content/Library/Paragraph"}},[t._v("Nobody is following this library")])],1)],1)},s=[],i=(a("99af"),a("a518")),n=a("0cd1"),o=a("bc3a"),l=a.n(o),c={props:["object"],components:{LibraryForm:n["a"],LibraryFilesTable:i["a"]},data:function(){return{isLoadingFollows:!1,follows:null}},created:function(){this.fetchFollows()},methods:{fetchFollows:function(){var t=this;t.isLoadingLibrary=!0,l.a.get("libraries/".concat(this.object.uuid,"/follows/")).then((function(e){t.follows=e.data,t.isLoadingFollows=!1}))},updateApproved:function(t,e){var a;a=e?"accept":"reject",l.a.post("federation/follows/library/".concat(t.uuid,"/").concat(a,"/")).then((function(a){t.isLoading=!1,t.approved=e}))}}},u=c,d=a("2877"),p=Object(d["a"])(u,r,s,!1,null,null,null);e["default"]=p.exports},d4fd:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{class:["ui","primary",{inverted:t.running},"icon","labeled","button"],on:{click:t.toggleRadio}},[a("i",{staticClass:"ui feed icon",attrs:{role:"button"}}),t.running?[a("translate",{attrs:{"translate-context":"*/Player/Button.Label/Short, Verb"}},[t._v("Stop radio")])]:[a("translate",{attrs:{"translate-context":"*/Queue/Button.Label/Short, Verb"}},[t._v("Start radio")])]],2)},s=[],i=a("ceb5"),n={props:{customRadioId:{required:!1},type:{type:String,required:!1},clientOnly:{type:Boolean,default:!1},objectId:{default:null}},methods:{toggleRadio:function(){this.running?this.$store.dispatch("radios/stop"):this.$store.dispatch("radios/start",{type:this.type,objectId:this.objectId,customRadioId:this.customRadioId,clientOnly:this.clientOnly})}},computed:{running:function(){var t=this.$store.state.radios,e=t.current;return!!t.running&&(e.type===this.type&&i["a"].isEqual(e.objectId,this.objectId)&&e.customRadioId===this.customRadioId)}}},o=n,l=a("2877"),c=Object(l["a"])(o,r,s,!1,null,null,null);e["a"]=c.exports},f0ac:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("main",{directives:[{name:"title",rawName:"v-title",value:t.labels.title,expression:"labels.title"}],staticClass:"main pusher"},[a("nav",{staticClass:"ui secondary pointing menu",attrs:{role:"navigation","aria-label":t.labels.secondaryMenu}},[a("router-link",{staticClass:"ui item",attrs:{to:{name:"content.libraries.index"}}},[a("translate",{attrs:{"translate-context":"*/*/*/Noun"}},[t._v("Libraries")])],1),a("router-link",{staticClass:"ui item",attrs:{to:{name:"content.libraries.files"}}},[a("translate",{attrs:{"translate-context":"*/*/*"}},[t._v("Tracks")])],1)],1),a("router-view",{key:t.$route.fullPath})],1)},s=[],i={computed:{labels:function(){var t=this.$pgettext("*/Library/*/Verb","Add content"),e=this.$pgettext("Menu/*/Hidden text","Secondary menu");return{title:t,secondaryMenu:e}}}},n=i,o=a("2877"),l=Object(o["a"])(n,r,s,!1,null,null,null);e["default"]=l.exports}}]);